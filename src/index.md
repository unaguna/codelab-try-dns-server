author: KOIZUMI Yusuke
summary: 仮想マシン上でDNSサーバを立ち上げて、LAN内向けに名前解決を提供します
id: try-dns-server
categories: named
environments: Web
status: Publish
Feedback Link: /


# 自宅 DNS サーバの立ち上げとレコード登録

## はじめに
Duration: 0:05:00

このハンズオンでは、次の手順で DNS サーバを構築します。

1. Oracle VirtualBox の仮想マシンに Almalinux (CentOS の後継) をインストールします。
2. named を設定して DNS サーバとして利用可能にします。
3. 特定のドメインについての名前解決を提供します。


### 環境

以下の環境・前提条件でハンズオンを記載します。自身の状況と異なる部分は適宜読み替えてください。

- ホスト側のマシンのOS: Windows 10
- ホスト側のマシンの仮想環境: Oracle VirtualBox 7.0
- 仮想マシンのOS: Almalinux 9

### 前提条件

- IP アドレスとネットワークについて知識があること。とくに
    - `192.168.0.0/20` と `192.168.0.0/24` の違いを理解していること
- 名前解決を知っていることとくに
    - `https://www.google.com/` にアクセスする際、ドメイン名 (`www.google.com`) とIPアドレスの紐づけが必要であることを理解していること
    - 上記の紐づけを担うサーバの名称を知っていること

### 具体的な設定値

以下の環境・前提条件でハンズオンを記載します。自身の状況と異なる部分は適宜読み替えてください。

- Windows 10 のマシンが属するネットワークは `192.168.0.0/24` である
- DNS サーバを `192.168.0.101` に設置する
- DNS サーバで `myserver.test` を `192.168.0.10` に解決する

## DNS サーバ立ち上げ

### 名前解決できるかを確認する

DNS サーバを設定したので、実際に名前解決ができるかを確認しましょう。ホスト側 (あるいは同一ネットワーク内の別の端末) で Powershell を起動し、下記のコマンドを実行します。

```powershell
nslookup google.com 192.168.0.101
```

IPアドレスが表示されれば成功です。

成功しない場合、以下の可能性があります。

- DNS サーバ (仮想マシン) へ到達できない
    - 下記のコマンドで IP 層レベルで疎通していることを確かめましょう。

        ```console
        ping 192.168.0.101
        ```

    - 疎通していない場合、次の点を確認しましょう。

        - DNS サーバを設置した仮想マシンのネットワーク設定が「ブリッジアダプター」であり有効になっていること
        - DNS サーバを設置した Almalinux のネットワーク設定で、IPv4 のアドレスが 192.168.0.101 (DNS サーバに与える予定のIPアドレス) になっていること。

- DNS サーバ（named プロセス）へ到達できない
    - ファイアーウォールによって阻まれている可能性があります。次の設定を確認してください。
        - DNS サーバを稼働している Almalinux のファイアーウォール (以前のステップで設定済みのはず)
        - (通常問題ないはずですが) Windows 10 のマシンのファイアウォール
        - (通常問題ないはずですが) ネットワーク機器のファイアーウォール

- DNS サーバ（named プロセス）によって遮断されている
    - `/etc/named.conf` の listen-on を確認し、ポート 53、アドレス 192.168.0.101 で待ち受けているかを確認しましょう。
    - `/etc/named.conf` の allow-query を確認し、192.168.0.0/24 (DNS利用者を含むアドレス範囲) が指定されているかを確認しましょう。
